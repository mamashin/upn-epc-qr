{% load i18n %}
<p class="large-text">{% trans "EPC QR code for payment via Revolut / Bunq / N26 / etc.." %}</p>
{% if amount_was_auto_set %}
<div class="grid">
    <div class="s12 m6 l6">
        <article class="border tertiary">
            <i>warning</i>
            <div>
                <p>{% trans "The amount was not specified in the original invoice and has been automatically set to 0.01 EUR. You can change it using the edit form or in your banking app." %}</p>
            </div>
        </article>
    </div>
</div>
{% endif %}
<div class="grid" id="scan_result">
    <div class="s12 m6 l6 center-align">
        <hr/>
        <div class="space"></div>
        <img alt="EPC QR code" src="data:image/png;base64,{{ img }}" class="qr-code"/>
        <div class="space"></div>
        <hr/>
        {% include 'qr_link.html' %}
        <div class="space"></div>
        {% if model.data_type == 'qr' or model.data_type == 'qr_edit' %}
        <button class="border round" onclick="ui('#pdf-settings-modal')">
            <i>download</i>
            <span>{% trans "Download Invoice" %}</span>
        </button>
        {% endif %}
    </div>
    <div id="manual_edit" class="s12 m6 l6">
        {% if direct_get and form %}
            {% include 'only_form.html' %}
        {% endif %}
    </div>
</div>

<!-- PDF Download Settings Modal -->
{% if model.data_type == 'qr' or model.data_type == 'qr_edit' %}
<dialog id="pdf-settings-modal" class="modal">
    <h5>{% trans "Invoice Download Settings" %}</h5>
    <br>
    <div>
        <div class="field label border">
            <select id="pdf-position">
                <option value="top" selected>{% trans "Top" %}</option>
                <option value="bottom">{% trans "Bottom" %}</option>
            </select>
            <label>{% trans "Position" %}</label>
            <span class="helper">{% trans "Where to place the payment slip on the page" %}</span>
        </div>
        <br>
        <label class="checkbox">
            <input type="checkbox" id="pdf-template" checked>
            <span>{% trans "Print background template" %}</span>
        </label>
    </div>
    <nav class="right-align">
        <button class="border" onclick="ui('#pdf-settings-modal')">{% trans "Cancel" %}</button>
        <button onclick="downloadPdf()">
            <i>download</i>
            <span>{% trans "Download" %}</span>
        </button>
    </nav>
</dialog>

<script>
function downloadPdf() {
    const position = document.getElementById('pdf-position').value;
    const template = document.getElementById('pdf-template').checked ? '1' : '0';
    const url = "{% url 'qr_pdf_download' model.rnd %}?position=" + position + "&template=" + template;

    // Close modal
    ui('#pdf-settings-modal');

    // Download file
    window.location.href = url;
}
</script>
{% endif %}